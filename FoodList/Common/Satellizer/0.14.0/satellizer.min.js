typeof module!="undefined"&&typeof exports!="undefined"&&module.exports===exports&&(module.exports="satellizer"),function(n,t,i){"use strict";n.location.origin||(n.location.origin=n.location.protocol+"//"+n.location.hostname+(n.location.port?":"+n.location.port:""));t.module("satellizer",[]).constant("SatellizerConfig",{httpInterceptor:function(){return!0},withCredentials:!1,tokenRoot:null,baseUrl:"/",loginUrl:"/auth/login",signupUrl:"/auth/signup",unlinkUrl:"/auth/unlink/",tokenName:"token",tokenPrefix:"satellizer",authHeader:"Authorization",authToken:"Bearer",storageType:"localStorage",providers:{facebook:{name:"facebook",url:"/auth/facebook",authorizationEndpoint:"https://www.facebook.com/v2.5/dialog/oauth",redirectUri:n.location.origin+"/",requiredUrlParams:["display","scope"],scope:["email"],scopeDelimiter:",",display:"popup",oauthType:"2.0",popupOptions:{width:580,height:400}},google:{name:"google",url:"/auth/google",authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",redirectUri:n.location.origin,requiredUrlParams:["scope"],optionalUrlParams:["display"],scope:["profile","email"],scopePrefix:"openid",scopeDelimiter:" ",display:"popup",oauthType:"2.0",popupOptions:{width:452,height:633}},github:{name:"github",url:"/auth/github",authorizationEndpoint:"https://github.com/login/oauth/authorize",redirectUri:n.location.origin,optionalUrlParams:["scope"],scope:["user:email"],scopeDelimiter:" ",oauthType:"2.0",popupOptions:{width:1020,height:618}},instagram:{name:"instagram",url:"/auth/instagram",authorizationEndpoint:"https://api.instagram.com/oauth/authorize",redirectUri:n.location.origin,requiredUrlParams:["scope"],scope:["basic"],scopeDelimiter:"+",oauthType:"2.0"},linkedin:{name:"linkedin",url:"/auth/linkedin",authorizationEndpoint:"https://www.linkedin.com/uas/oauth2/authorization",redirectUri:n.location.origin,requiredUrlParams:["state"],scope:["r_emailaddress"],scopeDelimiter:" ",state:"STATE",oauthType:"2.0",popupOptions:{width:527,height:582}},twitter:{name:"twitter",url:"/auth/twitter",authorizationEndpoint:"https://api.twitter.com/oauth/authenticate",redirectUri:n.location.origin,oauthType:"1.0",popupOptions:{width:495,height:645}},twitch:{name:"twitch",url:"/auth/twitch",authorizationEndpoint:"https://api.twitch.tv/kraken/oauth2/authorize",redirectUri:n.location.origin,requiredUrlParams:["scope"],scope:["user_read"],scopeDelimiter:" ",display:"popup",oauthType:"2.0",popupOptions:{width:500,height:560}},live:{name:"live",url:"/auth/live",authorizationEndpoint:"https://login.live.com/oauth20_authorize.srf",redirectUri:n.location.origin,requiredUrlParams:["display","scope"],scope:["wl.emails"],scopeDelimiter:" ",display:"popup",oauthType:"2.0",popupOptions:{width:500,height:560}},yahoo:{name:"yahoo",url:"/auth/yahoo",authorizationEndpoint:"https://api.login.yahoo.com/oauth2/request_auth",redirectUri:n.location.origin,scope:[],scopeDelimiter:",",oauthType:"2.0",popupOptions:{width:559,height:519}},bitbucket:{name:"bitbucket",url:"/auth/bitbucket",authorizationEndpoint:"https://bitbucket.org/site/oauth2/authorize",redirectUri:n.location.origin+"/",requiredUrlParams:["scope"],scope:["email"],scopeDelimiter:" ",oauthType:"2.0",popupOptions:{width:1028,height:529}}}}).provider("$auth",["SatellizerConfig",function(n){Object.defineProperties(this,{httpInterceptor:{get:function(){return n.httpInterceptor},set:function(t){n.httpInterceptor=typeof t=="function"?t:function(){return t}}},baseUrl:{get:function(){return n.baseUrl},set:function(t){n.baseUrl=t}},loginUrl:{get:function(){return n.loginUrl},set:function(t){n.loginUrl=t}},signupUrl:{get:function(){return n.signupUrl},set:function(t){n.signupUrl=t}},tokenRoot:{get:function(){return n.tokenRoot},set:function(t){n.tokenRoot=t}},tokenName:{get:function(){return n.tokenName},set:function(t){n.tokenName=t}},tokenPrefix:{get:function(){return n.tokenPrefix},set:function(t){n.tokenPrefix=t}},unlinkUrl:{get:function(){return n.unlinkUrl},set:function(t){n.unlinkUrl=t}},authHeader:{get:function(){return n.authHeader},set:function(t){n.authHeader=t}},authToken:{get:function(){return n.authToken},set:function(t){n.authToken=t}},withCredentials:{get:function(){return n.withCredentials},set:function(t){n.withCredentials=t}},storageType:{get:function(){return n.storageType},set:function(t){n.storageType=t}}});t.forEach(Object.keys(n.providers),function(i){this[i]=function(r){return t.extend(n.providers[i],r)}},this);var i=function(i){n.providers[i.name]=n.providers[i.name]||{};t.extend(n.providers[i.name],i)};this.oauth1=function(t){i(t);n.providers[t.name].oauthType="1.0"};this.oauth2=function(t){i(t);n.providers[t.name].oauthType="2.0"};this.$get=["$q","SatellizerShared","SatellizerLocal","SatellizerOauth",function(n,t,i,r){var u={};return u.login=function(n,t){return i.login(n,t)},u.signup=function(n,t){return i.signup(n,t)},u.logout=function(){return t.logout()},u.authenticate=function(n,t){return r.authenticate(n,t)},u.link=function(n,t){return r.authenticate(n,t)},u.unlink=function(n,t){return r.unlink(n,t)},u.isAuthenticated=function(){return t.isAuthenticated()},u.getToken=function(){return t.getToken()},u.setToken=function(n){t.setToken({access_token:n})},u.removeToken=function(){return t.removeToken()},u.getPayload=function(){return t.getPayload()},u.setStorageType=function(n){return t.setStorageType(n)},u}]}]).factory("SatellizerShared",["$q","$window","$log","SatellizerConfig","SatellizerStorage",function(r,u,f,e,o){var s={},h=e.tokenPrefix?[e.tokenPrefix,e.tokenName].join("_"):e.tokenName;return s.getToken=function(){return o.get(h)},s.getPayload=function(){var t=o.get(h),r,u;if(t&&t.split(".").length===3)try{return r=t.split(".")[1],u=r.replace(/-/g,"+").replace(/_/g,"/"),JSON.parse(decodeURIComponent(escape(n.atob(u))))}catch(f){return i}},s.setToken=function(n){var i,r,u,s;if(!n)return f.warn("Can't set token without passing a value");if(i=n&&n.access_token,i&&(t.isObject(i)&&t.isObject(i.data)?n=i:t.isString(i)&&(r=i)),!r&&n&&(u=e.tokenRoot&&e.tokenRoot.split(".").reduce(function(n,t){return n[t]},n.data),r=u?u[e.tokenName]:n.data&&n.data[e.tokenName]),!r)return s=e.tokenRoot?e.tokenRoot+"."+e.tokenName:e.tokenName,f.warn('Expecting a token named "'+s);o.set(h,r)},s.removeToken=function(){o.remove(h)},s.isAuthenticated=function(){var n=o.get(h),i;if(n){if(n.split(".").length===3)try{var r=n.split(".")[1],f=r.replace(/-/g,"+").replace(/_/g,"/"),t=JSON.parse(u.atob(f)).exp;if(t)return i=Math.round((new Date).getTime()/1e3)>=t,i?!1:!0}catch(e){return!0}return!0}return!1},s.logout=function(){return o.remove(h),r.when()},s.setStorageType=function(n){e.storageType=n},s}]).factory("SatellizerOauth",["$q","$http","SatellizerConfig","SatellizerUtils","SatellizerShared","SatellizerOauth1","SatellizerOauth2",function(n,t,i,r,u,f,e){var o={};return o.authenticate=function(t,r){var s=i.providers[t].oauthType==="1.0"?new f:new e,o=n.defer();return s.open(i.providers[t],r||{}).then(function(n){i.providers[t].url&&u.setToken(n,!1);o.resolve(n)}).catch(function(n){o.reject(n)}),o.promise},o.unlink=function(n,u){return u=u||{},u.url=u.url?u.url:r.joinUrl(i.baseUrl,i.unlinkUrl),u.data={provider:n}||u.data,u.method=u.method||"POST",u.withCredentials=u.withCredentials||i.withCredentials,t(u)},o}]).factory("SatellizerLocal",["$http","SatellizerUtils","SatellizerShared","SatellizerConfig",function(n,t,i,r){var u={};return u.login=function(u,f){return f=f||{},f.url=f.url?f.url:t.joinUrl(r.baseUrl,r.loginUrl),f.data=u||f.data,f.method=f.method||"POST",f.withCredentials=f.withCredentials||r.withCredentials,n(f).then(function(n){return i.setToken(n),n})},u.signup=function(i,u){return u=u||{},u.url=u.url?u.url:t.joinUrl(r.baseUrl,r.signupUrl),u.data=i||u.data,u.method=u.method||"POST",u.withCredentials=u.withCredentials||r.withCredentials,n(u)},u}]).factory("SatellizerOauth2",["$q","$http","$window","$timeout","SatellizerPopup","SatellizerUtils","SatellizerConfig","SatellizerStorage",function(i,r,u,f,e,o,s,h){return function(){var c={},u={defaultUrlParams:["response_type","client_id","redirect_uri"],responseType:"code",responseParams:{code:"code",clientId:"clientId",redirectUri:"redirectUri"}};return c.open=function(r,s){u=o.merge(r,u);var l=i.defer();return f(function(){var i,f,r=u.name+"_state";return t.isFunction(u.state)?h.set(r,u.state()):t.isString(u.state)&&h.set(r,u.state),i=[u.authorizationEndpoint,c.buildQueryString()].join("?"),f=n.cordova?e.open(i,u.name,u.popupOptions,u.redirectUri).eventListener(u.redirectUri):e.open(i,u.name,u.popupOptions,u.redirectUri).pollPopup(u.redirectUri),f.then(function(n){if(u.responseType!=="token"&&u.url||l.resolve(n),n.state&&n.state!==h.get(r))return l.reject("The value returned in the state parameter does not match the state value from your original authorization code request.");l.resolve(c.exchangeForToken(n,s))})}),l.promise},c.exchangeForToken=function(n,i){var f=t.extend({},i),e;return t.forEach(u.responseParams,function(t,i){switch(i){case"code":f[t]=n.code;break;case"clientId":f[t]=u.clientId;break;case"redirectUri":f[t]=u.redirectUri;break;default:f[t]=n[i]}}),n.state&&(f.state=n.state),e=s.baseUrl?o.joinUrl(s.baseUrl,u.url):u.url,r.post(e,f,{withCredentials:s.withCredentials})},c.buildQueryString=function(){var n=[];return t.forEach(["defaultUrlParams","requiredUrlParams","optionalUrlParams"],function(i){t.forEach(u[i],function(i){var e=o.camelCase(i),r=t.isFunction(u[i])?u[i]():u[e],f;(i!=="redirect_uri"||r)&&(i==="state"&&(f=u.name+"_state",r=encodeURIComponent(h.get(f))),i==="scope"&&Array.isArray(r)&&(r=r.join(u.scopeDelimiter),u.scopePrefix&&(r=[u.scopePrefix,r].join(u.scopeDelimiter))),n.push([i,r]))})}),n.map(function(n){return n.join("=")}).join("&")},c}}]).factory("SatellizerOauth1",["$q","$http","SatellizerPopup","SatellizerConfig","SatellizerUtils",function(i,r,u,f,e){return function(){var o={},i={url:null,name:null,popupOptions:null,redirectUri:null,authorizationEndpoint:null};return o.open=function(s,h){t.extend(i,s);var c,l=f.baseUrl?e.joinUrl(f.baseUrl,i.url):i.url;return n.cordova||(c=u.open("",i.name,i.popupOptions,i.redirectUri)),r.post(l,i).then(function(t){var r=[i.authorizationEndpoint,o.buildQueryString(t.data)].join("?"),f;return n.cordova?c=u.open(r,i.name,i.popupOptions,i.redirectUri):c.popupWindow.location=r,f=n.cordova?c.eventListener(i.redirectUri):c.pollPopup(i.redirectUri),f.then(function(n){return o.exchangeForToken(n,h)})})},o.exchangeForToken=function(n,u){var o=t.extend({},u,n),s=f.baseUrl?e.joinUrl(f.baseUrl,i.url):i.url;return r.post(s,o,{withCredentials:f.withCredentials})},o.buildQueryString=function(n){var i=[];return t.forEach(n,function(n,t){i.push(encodeURIComponent(t)+"="+encodeURIComponent(n))}),i.join("&")},o}}]).factory("SatellizerPopup",["$q","$interval","$window","SatellizerConfig","SatellizerUtils",function(r,u,f,e,o){var s={};return s.url="",s.popupWindow=null,s.open=function(t,i,r){s.url=t;var u=s.stringifyOptions(s.prepareOptions(r)),e=f.navigator.userAgent,o=n.cordova||e.indexOf("CriOS")>-1?"_blank":i;return s.popupWindow=f.open(t,o,u),f.popup=s.popupWindow,s.popupWindow&&s.popupWindow.focus&&s.popupWindow.focus(),s},s.eventListener=function(n){var i=r.defer();return s.popupWindow.addEventListener("loadstart",function(r){var u;if(r.url.indexOf(n)===0&&(u=document.createElement("a"),u.href=r.url,u.search||u.hash)){var e=u.search.substring(1).replace(/\/$/,""),h=u.hash.substring(1).replace(/\/$/,""),c=o.parseQueryString(h),f=o.parseQueryString(e);t.extend(f,c);f.error||i.resolve(f);s.popupWindow.close()}}),s.popupWindow.addEventListener("loaderror",function(){i.reject("Authorization Failed")}),i.promise},s.pollPopup=function(n){var f=r.defer(),h=document.createElement("a"),c,e;return h.href=n,c=o.getFullUrlPath(h),e=u(function(){var r;(!s.popupWindow||s.popupWindow.closed||s.popupWindow.closed===i)&&(f.reject("The popup window was closed."),u.cancel(e));try{if(r=o.getFullUrlPath(s.popupWindow.location),r===c){if(s.popupWindow.location.search||s.popupWindow.location.hash){var h=s.popupWindow.location.search.substring(1).replace(/\/$/,""),l=s.popupWindow.location.hash.substring(1).replace(/[\/$]/,""),a=o.parseQueryString(l),n=o.parseQueryString(h);t.extend(n,a);n.error?f.reject(n):f.resolve(n)}else f.reject("Redirect has occurred but no query or hash parameters were found. They were either not set during the redirect, or were removed before Satellizer could read them, e.g. AngularJS routing mechanism.");u.cancel(e);s.popupWindow.close()}}catch(v){}},20),f.promise},s.prepareOptions=function(n){n=n||{};var i=n.width||500,r=n.height||500;return t.extend({width:i,height:r,left:f.screenX+(f.outerWidth-i)/2,top:f.screenY+(f.outerHeight-r)/2.5},n)},s.stringifyOptions=function(n){var i=[];return t.forEach(n,function(n,t){i.push(t+"="+n)}),i.join(",")},s}]).service("SatellizerUtils",function(){this.getFullUrlPath=function(n){return n.protocol+"//"+n.hostname+(n.port?":"+n.port:"")+n.pathname};this.camelCase=function(n){return n.replace(/([\:\-\_]+(.))/g,function(n,t,i,r){return r?i.toUpperCase():i})};this.parseQueryString=function(n){var r={},u,i;return t.forEach((n||"").split("&"),function(n){n&&(i=n.split("="),u=decodeURIComponent(i[0]),r[u]=t.isDefined(i[1])?decodeURIComponent(i[1]):!0)}),r};this.joinUrl=function(n,t){if(/^(?:[a-z]+:)?\/\//i.test(t))return t;var i=[n,t].join("/"),r=function(n){return n.replace(/[\/]+/g,"/").replace(/\/\?/g,"?").replace(/\/\#/g,"#").replace(/\:\//g,"://")};return r(i)};this.merge=function(n,t){var r={};for(var i in n)n.hasOwnProperty(i)&&(r[i]=i in t&&typeof n[i]=="object"&&i!==null?this.merge(n[i],t[i]):n[i]);for(i in t)if(t.hasOwnProperty(i)){if(i in r)continue;r[i]=t[i]}return r}}).factory("SatellizerStorage",["$window","$log","SatellizerConfig",function(n,t,i){var u={},r=function(){var t,r;try{return t=i.storageType in n&&n[i.storageType]!==null,t&&(r=Math.random().toString(36).substring(7),n[i.storageType].setItem(r,""),n[i.storageType].removeItem(r)),t}catch(u){return!1}}();return r||t.warn(i.storageType+" is not available."),{get:function(t){return r?n[i.storageType].getItem(t):u[t]},set:function(t,f){return r?n[i.storageType].setItem(t,f):u[t]=f},remove:function(t){return r?n[i.storageType].removeItem(t):delete u[t]}}}]).factory("SatellizerInterceptor",["$q","SatellizerConfig","SatellizerStorage","SatellizerShared",function(n,t,i,r){return{request:function(n){if(n.skipAuthorization)return n;if(r.isAuthenticated()&&t.httpInterceptor(n)){var f=t.tokenPrefix?t.tokenPrefix+"_"+t.tokenName:t.tokenName,u=i.get(f);t.authHeader&&t.authToken&&(u=t.authToken+" "+u);n.headers[t.authHeader]=u}return n},responseError:function(t){return n.reject(t)}}}]).config(["$httpProvider",function(n){n.interceptors.push("SatellizerInterceptor")}])}(window,window.angular);
//# sourceMappingURL=satellizer.min.js.map
